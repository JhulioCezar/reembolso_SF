<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>SolicitaÃ§Ã£o de Reembolso - Sem Fronteiras</title>
Â  <link rel="manifest" href="manifest.json" />
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
Â  <style>
Â  Â  body { font-family: Arial, sans-serif; background-color: #f7f9fb; margin: 0; padding: 0; }
Â  Â  .container {
Â  Â  Â  Â  width: 95%;
Â  Â  Â  Â  max-width: 800px;
Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  padding: 30px 50px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  box-shadow: 0 0 10px rgba(0,0,0,0.1);
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  .header { text-align: center; padding: 15px 0; }
Â  Â  .header img { max-height: 80px; width: auto; }
Â  Â  .titulo { text-align: center; background-color: #1c6ba0; color: white; font-weight: bold; padding: 10px; border-radius: 4px; margin: 25px 0 30px 0; font-size: 20px; }
Â  Â  label { font-weight: bold; }
Â  Â  input, textarea, select { width: 100%; padding: 6px; margin-top: 4px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; background-color: #fff; }
Â  Â  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
Â  Â  th, td { border: none; padding: 12px 8px; text-align: center; vertical-align: middle; border-bottom: 1px solid #eee; }
Â  Â  th { background-color: transparent; border-bottom: 2px solid #1c6ba0; font-weight: bold; }
Â  Â  .add-row { background-color: #0072bb; color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
Â  Â  .remove-row { color: red; cursor: pointer; font-weight: bold; user-select: none; }
Â  Â  .total { text-align: right; font-weight: bold; font-size: 1.1em; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
Â  Â  .comprovante-container { display: flex; align-items: center; margin-top: 30px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; flex-wrap: wrap; }
Â  Â  .comprovante-actions { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; }
Â  Â  .comprovante-actions strong { font-size: 1em; margin-right: 15px; }
Â  Â  .anexo-btn { background-color:#0072bb; color:white; border: none; padding: 8px 12px; font-size: 0.9em; border-radius:4px; cursor:pointer; margin: 0 5px; white-space: nowrap; }
Â  Â  #lista-comprovantes { display: flex; flex-wrap: wrap; gap: 8px; margin-left: 15px; align-items: center; }
Â  Â  .arquivo-item { background-color: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 0.85em; display: flex; align-items: center; }
Â  Â  .remove-arquivo { margin-left: 8px; color: #d9534f; font-weight: bold; cursor: pointer; }
Â  Â  .assinaturas-container { display: flex; justify-content: space-around; align-items: flex-start; margin-top: 40px; gap: 30px; }
Â  Â  .assinatura-bloco { flex: 1; text-align: center; }
Â  Â  .assinatura { margin-top: 0; text-align: center; }
Â  Â  #signature-pad { border: 2px solid #ccc; border-radius: 6px; width: 100%; max-width: 300px; height: 120px; margin: 0 auto; background-color: #fafafa; cursor: crosshair; touch-action: none; }
Â  Â  .assinatura-btns button { background-color: #0072bb; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer; }
Â  Â  .assinatura-line { border-top: 1px solid #000; width: 100%; max-width: 300px; margin: 135px auto 0 auto; }
Â  Â  #supervisorNome { display: block; width: 100%; max-width: 300px; margin: 8px auto 0 auto; text-align: center; }
Â  Â  .btn-print { background-color: #5cb85c; color: white; }
Â  Â  .btn-secondary { background-color: #0072bb; color: white; margin-right: 10px; }
Â  Â  .btn-danger { background-color: #d9534f; color: white; }
Â  Â  .btn-print, .btn-secondary, .btn-danger { border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 20px; }
Â  Â  .pix-group { display: flex; gap: 15px; flex-wrap: wrap; }
Â  Â  #print-only-content { display: none; }
Â  Â Â 
Â  Â  /* ADICIONADO: Estilos para o modal de escolha */
Â  Â  .modal-overlay {
Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  background-color: rgba(0,0,0,0.5); z-index: 100; display: none;
Â  Â  }
Â  Â  .modal {
Â  Â  Â  Â  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  background-color: white; padding: 25px; border-radius: 8px;
Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 101; display: none;
Â  Â  Â  Â  width: 90%; max-width: 350px; text-align: center;
Â  Â  }
Â  Â  .modal p { margin-top: 0; font-weight: bold; font-size: 1.1em; }
Â  Â  .modal button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; background-color: #f0f0f0; cursor: pointer; font-size: 1em; }
Â  Â  .modal button.btn-danger { background-color: #d9534f; color: white; border: none; }
Â  Â Â 
Â  Â  /* ESTILOS PARA GERAÃ‡ÃƒO DE PDF (html2canvas) */
Â  Â  /* O .pdf-generation-mode serÃ¡ aplicado via JS antes de gerar o PDF */
Â  Â  .pdf-generation-mode .add-row,
Â  Â  .pdf-generation-mode .remove-row,
Â  Â  .pdf-generation-mode .comprovante-actions,
Â  Â  .pdf-generation-mode #lista-comprovantes,
Â  Â  .pdf-generation-mode .assinatura-btns,
Â  Â  .pdf-generation-mode .btn-print,
Â  Â  .pdf-generation-mode .btn-secondary,
Â  Â  .pdf-generation-mode .btn-danger,
Â  Â  .pdf-generation-mode .remove-arquivo {
Â  Â  Â  Â  display: none !important;
Â  Â  }
Â  Â  .pdf-generation-mode #tabelaDespesas input,
Â  Â  .pdf-generation-mode #supervisorNome {
Â  Â  Â  Â  border: none !important;
Â  Â  Â  Â  box-shadow: none !important;
Â  Â  Â  Â  background-color: transparent !important;
Â  Â  Â  Â  -webkit-appearance: none; /* Remove setas no Chrome/Safari */
Â  Â  Â  Â  margin: 0;
Â  Â  }
Â  Â  .pdf-generation-mode input[type=number] {
Â  Â  Â  Â  -moz-appearance: textfield; /* Remove setas no Firefox */
Â  Â  }
Â  Â Â 
Â  Â  @media print {
Â  Â  Â  Â  body { background: #fff; }
Â  Â  Â  Â  .container { box-shadow: none; margin: 0; width: auto; border-radius: 0; }
Â  Â  Â  Â  .add-row, .remove-row, .anexo-btn, .assinatura-btns, .btn-print, .btn-secondary, .btn-danger,
Â  Â  Â  Â  .comprovante-container { display: none !important; }
Â  Â  Â  Â  input, select, textarea { border: none !important; background-color: transparent !important; box-shadow: none !important; -webkit-appearance: none; -moz-appearance: none; appearance: none; }
Â  Â  Â  Â  #print-only-content { display: block !important; }
Â  Â  Â  Â  #tabelaDespesas input, #tabelaDespesas .remove-row { display: none !important; }
Â  Â  Â  Â  .print-value { display: block !important; font-size: 10pt; text-align: center; }
Â  Â  Â  Â  #tabelaDespesas { table-layout: fixed; width: 100%; border-collapse: collapse; }
Â  Â  Â  Â  #tabelaDespesas th, #tabelaDespesas td { border: none; border-bottom: 1px solid #ccc; padding: 8px; }
Â  Â  Â  Â  #tabelaDespesas th { border-bottom: 2px solid #000; }
Â  Â  Â  Â  .print-page { page-break-before: always; text-align: center; padding-top: 40px; }
Â  Â  Â  Â  .print-page img { max-width: 90%; max-height: 80vh; border: 1px solid #ccc; }
Â  Â  }
Â  Â Â 
Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 0;
Â  Â  Â  Â  Â  Â  box-shadow: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .pix-group, .assinaturas-container {
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .assinatura-bloco {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 350px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .assinatura-line {
Â  Â  Â  Â  Â  Â  margin-top: 40px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header img {
Â  Â  Â  Â  Â  Â  max-height: 60px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .titulo {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .comprovante-container {
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #lista-comprovantes {
Â  Â  Â  Â  Â  Â  margin-left: 0;
Â  Â  Â  Â  }
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="header"> <img src="https://i.imgur.com/dvzRyus.png" alt="Sem Fronteiras Logo"> </div>
Â  Â  <div class="titulo">SolicitaÃ§Ã£o de Reembolso</div>
Â  Â  <label for="nomeSolicitante">Nome do solicitante:</label>
Â  Â  <input type="text" id="nomeSolicitante" placeholder="Digite o nome completo" autocapitalize="words">
Â  Â  <p>Venho por meio deste solicitar o reembolso das despesas informadas abaixo:</p>
Â  Â  <table id="tabelaDespesas">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th style="width: 20%;">Data</th>
Â  Â  Â  Â  Â  <th style="width: 50%;">DescriÃ§Ã£o da Despesa</th>
Â  Â  Â  Â  Â  <th style="width: 25%;">Valor (R$)</th>
Â  Â  Â  Â  Â  <th style="width: 5%;"></th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  Â  <button class="add-row" type="button" onclick="adicionarLinha()">+ Adicionar despesa</button>
Â  Â  <div class="total">Total a Reembolsar: R$ <span id="total">0,00</span></div>
Â  Â  <h3>Dados para transferÃªncia via Pix:</h3>
Â  Â  <div class="pix-group">
Â  Â  Â  Â  <div><label for="tipoPix">Tipo de Chave Pix:</label><select id="tipoPix" onchange="configurarInputPix()"><option value="cpf_cnpj">CPF/CNPJ</option><option value="celular">Celular (DD + NÃºmero)</option><option value="email">E-mail</option><option value="aleatoria">Chave AleatÃ³ria</option></select></div>
Â  Â  Â  Â  <div><label for="chavePixInput">Chave Pix:</label><input type="text" id="chavePixInput" placeholder="Digite o CPF ou CNPJ" /></div>
Â  Â  </div>

Â  Â  <div class="comprovante-container">
Â  Â  Â  <div class="comprovante-actions">
Â  Â  Â  Â  Â  <strong>Comprovantes:</strong>
Â  Â  Â  Â  Â  <button class="anexo-btn" onclick="inserirComprovante()">Inserir Comprovante(s)</button>
Â  Â  Â  </div>
Â  Â  Â  <div id="lista-comprovantes"></div>
Â  Â  </div>

Â  Â  <div class="assinaturas-container">
Â  Â  Â  Â  <div class="assinatura-bloco">
Â  Â  Â  Â  Â  Â  <div class="assinatura">
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Assinatura Digital do Solicitante:</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="signature-pad"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="assinatura-btns">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="limparAssinatura()">Limpar</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="assinatura-bloco">
Â  Â  Â  Â  Â  Â  <div class="assinatura">
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Assinatura do Supervisor:</strong></p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="assinatura-line"></div> Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="supervisorNome" placeholder="Nome do Supervisor por Extenso" autocapitalize="words" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div style="text-align:center;">
Â  Â  Â  <button class="btn-secondary" onclick="prepararEImprimir()">Imprimir</button>
Â  Â  Â  <button class="btn-print" onclick="gerarPDF()">Salvar em PDF</button>
Â  Â  Â  <button class="btn-danger" onclick="limparFormulario()">Limpar FormulÃ¡rio</button>
Â  Â  </div>

Â  Â  <div id="print-only-content"></div>
Â  </div>

Â  <div id="comprovante-modal-overlay" class="modal-overlay" onclick="fecharModalComprovante()"></div>
Â  <div id="comprovante-modal" class="modal">
Â  Â  <p>Adicionar comprovante</p>
Â  Â  <button onclick="escolherOpcaoComprovante('camera')">ğŸ“· Abrir CÃ¢mera</button>
Â  Â  <button onclick="escolherOpcaoComprovante('arquivo')">ğŸ“ Procurar Arquivos</button>
Â  Â  <button class="btn-danger" onclick="fecharModalComprovante()">Cancelar</button>
Â  </div>

Â  <script>
Â  Â  let signatureCanvas, signatureCtx, signatureDrawing = false;
Â  Â  let comprovantes = [];
Â  Â  const regexEmail = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
Â  Â  const hoje = new Date();
Â  Â  const dia = String(hoje.getDate()).padStart(2, '0');
Â  Â  const mes = String(hoje.getMonth() + 1).padStart(2, '0');
Â  Â  const ano = hoje.getFullYear();
Â  Â  const dataMaxima = `${ano}-${mes}-${dia}`;

Â  Â  function validarFormulario() {
Â  Â  Â  Â  const nome = document.getElementById("nomeSolicitante").value.trim();
Â  Â  Â  Â  if (nome === "") { alert("Por favor, preencha o nome do solicitante."); return false; }
Â  Â  Â  Â  let despesaInvalida = false;
Â  Â  Â  Â  document.querySelectorAll('#tabelaDespesas tbody tr').forEach((linha) => {
Â  Â  Â  Â  Â  Â  const data = linha.querySelector('input[type="date"]').value;
Â  Â  Â  Â  Â  Â  const descricao = linha.querySelector('input[type="text"]').value.trim();
Â  Â  Â  Â  Â  Â  const valor = linha.querySelector('input[type="number"]').value.trim();
Â  Â  Â  Â  Â  Â  if ((descricao !== '' || valor !== '') && data === '') { despesaInvalida = true; }
Â  Â  Â  Â  });
Â  Â  Â  Â  if (despesaInvalida) { alert("Por favor, preencha a data para todas as despesas informadas."); return false; }
Â  Â  Â  Â  const tipoPix = document.getElementById("tipoPix").value;
Â  Â  Â  Â  let pix = document.getElementById("chavePixInput").value.trim();
Â  Â  Â  Â  let isValidPix = true;
Â  Â  Â  Â  let mensagemErro = "";
Â  Â  Â  Â  if (tipoPix === 'cpf_cnpj' || tipoPix === 'celular') { pix = pix.replace(/[\.\-\/()\s]/g, ''); }
Â  Â  Â  Â  switch (tipoPix) {
Â  Â  Â  Â  Â  Â  case 'cpf_cnpj': if (pix.length !== 11 && pix.length !== 14) { isValidPix = false; mensagemErro = "O CPF deve ter 11 dÃ­gitos e o CNPJ 14."; } break;
Â  Â  Â  Â  Â  Â  case 'celular': if (pix.length < 10 || pix.length > 11) { isValidPix = false; mensagemErro = "O celular deve conter DDD e 8 ou 9 dÃ­gitos."; } break;
Â  Â  Â  Â  Â  Â  case 'email': if (!regexEmail.test(pix)) { isValidPix = false; mensagemErro = "O formato do E-mail estÃ¡ invÃ¡lido."; } break;
Â  Â  Â  Â  Â  Â  case 'aleatoria': if (pix.length === 0) { isValidPix = false; mensagemErro = "A Chave AleatÃ³ria nÃ£o pode ser vazia."; } break;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!isValidPix) { alert("Erro na Chave Pix: " + mensagemErro); return false; }
Â  Â  Â  Â  return true;
Â  Â  }
Â  Â Â 
Â  Â  function capitalizarNomeProprio(nome) { if (!nome) return ''; const excecoes = ['e', 'de', 'da', 'do', 'das', 'dos']; return nome.toLowerCase().split(' ').map((palavra, index) => { if (index > 0 && excecoes.includes(palavra)) { return palavra; } return palavra.charAt(0).toUpperCase() + palavra.slice(1); }).join(' '); }
Â  Â Â 
Â  Â  function getImageBase64(url) {
Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  img.crossOrigin = 'Anonymous';
Â  Â  Â  Â  Â  Â  img.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = img.width;
Â  Â  Â  Â  Â  Â  Â  Â  canvas.height = img.height;
Â  Â  Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(img, 0, 0);
Â  Â  Â  Â  Â  Â  Â  Â  resolve(canvas.toDataURL('image/png'));
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  img.onerror = reject;
Â  Â  Â  Â  Â  Â  img.src = url;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  async function gerarPDF() {
Â  Â  Â  Â  if (!validarFormulario()) { return; }
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const logoUrl = 'https://i.imgur.com/dvzRyus.png';
Â  Â  Â  Â  Â  Â  const logoBase64 = await getImageBase64(logoUrl);
Â  Â  Â  Â  Â  Â  const nome = document.getElementById("nomeSolicitante").value;
Â  Â  Â  Â  Â  Â  const tipoPixSelect = document.getElementById("tipoPix");
Â  Â  Â  Â  Â  Â  const tipoPix = tipoPixSelect.options[tipoPixSelect.selectedIndex].text;
Â  Â  Â  Â  Â  Â  const chavePix = document.getElementById("chavePixInput").value;
Â  Â  Â  Â  Â  Â  const supervisor = document.getElementById("supervisorNome").value;
Â  Â  Â  Â  Â  Â  const total = document.getElementById("total").textContent;
Â  Â  Â  Â  Â  Â  const assinaturaImg = signatureCanvas.toDataURL('image/png');
Â  Â  Â  Â  Â  Â  const despesas = [];
Â  Â  Â  Â  Â  Â  document.querySelectorAll('#tabelaDespesas tbody tr').forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  const dataInput = row.querySelector('input[type="date"]');
Â  Â  Â  Â  Â  Â  Â  Â  const descricaoInput = row.querySelector('input[type="text"]');
Â  Â  Â  Â  Â  Â  Â  Â  const valorInput = row.querySelector('input[type="number"]');
Â  Â  Â  Â  Â  Â  Â  Â  if (dataInput && descricaoInput && valorInput && (dataInput.value || descricaoInput.value || valorInput.value)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  despesas.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: dataInput.value ? dataInput.value.split('-').reverse().join('/') : '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  descricao: descricaoInput.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  valor: parseFloat(valorInput.value || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  Â  Â  const pdf = new jsPDF('p', 'mm', 'a4');
Â  Â  Â  Â  Â  Â  const pageWidth = pdf.internal.pageSize.getWidth();
Â  Â  Â  Â  Â  Â  const margin = 15;
Â  Â  Â  Â  Â  Â  let y = 15;
Â  Â  Â  Â  Â  Â  const logoWidth = 50;
Â  Â  Â  Â  Â  Â  const logoX = (pageWidth - logoWidth) / 2;
Â  Â  Â  Â  Â  Â  pdf.addImage(logoBase64, 'PNG', logoX, y, logoWidth, 12);
Â  Â  Â  Â  Â  Â  y += 25;
Â  Â  Â  Â  Â  Â  pdf.setFontSize(18);
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text("SolicitaÃ§Ã£o de Reembolso", pageWidth / 2, y, { align: 'center' });
Â  Â  Â  Â  Â  Â  y += 15;
Â  Â  Â  Â  Â  Â  pdf.setFontSize(11);
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'normal');
Â  Â  Â  Â  Â  Â  const labelNome = "Nome do solicitante: ";
Â  Â  Â  Â  Â  Â  const labelNomeWidth = pdf.getTextWidth(labelNome);
Â  Â  Â  Â  Â  Â  pdf.text(labelNome, margin, y);
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text(nome, margin + labelNomeWidth, y);
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'normal');
Â  Â  Â  Â  Â  Â  y += 7;
Â  Â  Â  Â  Â  Â  const introLines = pdf.splitTextToSize("Venho por meio deste solicitar o reembolso das despesas informadas abaixo:", pageWidth - (margin * 2));
Â  Â  Â  Â  Â  Â  pdf.text(introLines, margin, y);
Â  Â  Â  Â  Â  Â  y += (introLines.length * 5) + 5;
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text("Data", margin, y);
Â  Â  Â  Â  Â  Â  pdf.text("DescriÃ§Ã£o da Despesa", margin + 30, y);
Â  Â  Â  Â  Â  Â  pdf.text("Valor (R$)", pageWidth - margin, y, { align: 'right' });
Â  Â  Â  Â  Â  Â  y += 2;
Â  Â  Â  Â  Â  Â  pdf.line(margin, y, pageWidth - margin, y);
Â  Â  Â  Â  Â  Â  y += 5;
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  despesas.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  const descLines = pdf.splitTextToSize(d.descricao, 110);
Â  Â  Â  Â  Â  Â  Â  Â  const rowHeight = (descLines.length * 5) + 3;
Â  Â  Â  Â  Â  Â  Â  Â  if (y + rowHeight > 270) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pdf.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y = 20;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const textY = y + (rowHeight / 2) - 2;
Â  Â  Â  Â  Â  Â  Â  Â  pdf.text(d.data, margin, textY);
Â  Â  Â  Â  Â  Â  Â  Â  pdf.text(descLines, margin + 30, y);
Â  Â  Â  Â  Â  Â  Â  Â  pdf.text(d.valor, pageWidth - margin, textY, { align: 'right' });
Â  Â  Â  Â  Â  Â  Â  Â  y += rowHeight;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'normal');
Â  Â  Â  Â  Â  Â  y += 5;
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text(`Total a Reembolsar: R$ ${total}`, pageWidth - margin, y, { align: 'right' });
Â  Â  Â  Â  Â  Â  y += 15;
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text("Dados para transferÃªncia via Pix:", margin, y);
Â  Â  Â  Â  Â  Â  y += 7;
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'normal');
Â  Â  Â  Â  Â  Â  const col1X = margin;
Â  Â  Â  Â  Â  Â  const col2X = pageWidth / 2;
Â  Â  Â  Â  Â  Â  pdf.text(`Tipo de Chave: ${tipoPix}`, col1X, y);
Â  Â  Â  Â  Â  Â  pdf.text(`Chave: ${chavePix}`, col2X, y);
Â  Â  Â  Â  Â  Â  let signatureY = 230;
Â  Â  Â  Â  Â  Â  if (y > 210) {
Â  Â  Â  Â  Â  Â  Â  Â  pdf.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  signatureY = 30;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const solicitanteX = margin;
Â  Â  Â  Â  Â  Â  const supervisorX = pageWidth / 2 + 5;
Â  Â  Â  Â  Â  Â  pdf.addImage(assinaturaImg, 'PNG', solicitanteX, signatureY, 70, 25);
Â  Â  Â  Â  Â  Â  pdf.line(solicitanteX, signatureY + 26, solicitanteX + 70, signatureY + 26);
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text("Assinatura do Solicitante", solicitanteX + 35, signatureY + 31, { align: 'center' });
Â  Â  Â  Â  Â  Â  // CORRIGIDO: Desenha a linha do Supervisor diretamente no PDF
Â  Â  Â  Â  Â  Â  pdf.line(supervisorX, signatureY + 26, supervisorX + 70, signatureY + 26);
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  Â  pdf.text(supervisor, supervisorX + 35, signatureY + 31, { align: 'center', fontStyle: 'bold' });
Â  Â  Â  Â  Â  Â  pdf.setFont(undefined, 'normal');
Â  Â  Â  Â  Â  Â  pdf.text("Assinatura do Supervisor", supervisorX + 35, signatureY + 36, { align: 'center' });
Â  Â  Â  Â  Â  Â  // FIM DA CORREÃ‡ÃƒO
Â  Â  Â  Â  Â  Â  comprovantes.forEach((comprovante, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  pdf.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  const title = `Comprovante ${index + 1}`;
Â  Â  Â  Â  Â  Â  Â  Â  const imgProps = pdf.getImageProperties(comprovante.src);
Â  Â  Â  Â  Â  Â  Â  Â  const innerMargin = 15;
Â  Â  Â  Â  Â  Â  Â  Â  const maxWidth = pdf.internal.pageSize.getWidth() - innerMargin * 2;
Â  Â  Â  Â  Â  Â  Â  Â  const maxHeight = pdf.internal.pageSize.getHeight() - innerMargin * 2 - 20;
Â  Â  Â  Â  Â  Â  Â  Â  const ratio = Math.min(maxWidth / imgProps.width, maxHeight / imgProps.height);
Â  Â  Â  Â  Â  Â  Â  Â  const w = imgProps.width * ratio;
Â  Â  Â  Â  Â  Â  Â  Â  const h = imgProps.height * ratio;
Â  Â  Â  Â  Â  Â  Â  Â  const x = (pdf.internal.pageSize.getWidth() - w) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  const y_img = (pdf.internal.pageSize.getHeight() - h) / 2 + 10;
Â  Â  Â  Â  Â  Â  Â  Â  pdf.setFontSize(12);
Â  Â  Â  Â  Â  Â  Â  Â  pdf.text(title, pdf.internal.pageSize.getWidth() / 2, innerMargin, { align: 'center' });
Â  Â  Â  Â  Â  Â  Â  Â  pdf.addImage(comprovante.src, 'PNG', x, y_img, w, h);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  pdf.save(`reembolso_${nome.replace(/\s+/g, '_')}.pdf`);
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Erro ao gerar PDF:", error);
Â  Â  Â  Â  Â  Â  alert("NÃ£o foi possÃ­vel gerar o PDF. Verifique sua conexÃ£o com a internet e tente novamente.");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function prepararEImprimir() { if (!validarFormulario()) { return; } document.querySelectorAll('#tabelaDespesas tbody td').forEach(cell => { const input = cell.querySelector('input'); if (input) { let valor = input.type === 'date' && input.value ? input.value.split('-').reverse().join('/') : input.value; const span = document.createElement('span'); span.className = 'print-value'; span.textContent = valor; cell.appendChild(span); } }); const printContent = document.getElementById('print-only-content'); printContent.innerHTML = ''; comprovantes.forEach((comprovante, index) => { const page = document.createElement('div'); page.className = 'print-page'; const title = document.createElement('h2'); title.textContent = `Comprovante ${index + 1}`; const img = document.createElement('img'); img.src = comprovante.src; page.appendChild(title); page.appendChild(img); printContent.appendChild(page); }); setTimeout(window.print, 100); }
Â  Â Â 
Â  Â  // ALTERADO: FunÃ§Ãµes para controlar o modal de escolha
Â  Â  const modal = document.getElementById('comprovante-modal');
Â  Â  const overlay = document.getElementById('comprovante-modal-overlay');

Â  Â  function inserirComprovante() {
Â  Â  Â  Â  modal.style.display = 'block';
Â  Â  Â  Â  overlay.style.display = 'block';
Â  Â  }

Â  Â  function fecharModalComprovante() {
Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  overlay.style.display = 'none';
Â  Â  }

Â  Â  function escolherOpcaoComprovante(tipo) {
Â  Â  Â  Â  const input = document.createElement('input');
Â  Â  Â  Â  input.type = 'file';
Â  Â  Â  Â  input.accept = 'image/jpeg,image/png';

Â  Â  Â  Â  if (tipo === 'camera') {
Â  Â  Â  Â  Â  Â  input.setAttribute('capture', 'environment');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  input.multiple = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  input.onchange = e => {
Â  Â  Â  Â  Â  Â  const files = e.target.files;
Â  Â  Â  Â  Â  Â  if (!files.length) return;
Â  Â  Â  Â  Â  Â  for (const file of files) {
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comprovantes.push({ filename: file.name, src: event.target.result });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderizarComprovantes();
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  input.click();
Â  Â  Â  Â  fecharModalComprovante();
Â  Â  }
Â  Â Â 
Â  Â  function renderizarComprovantes() { const listaArea = document.getElementById('lista-comprovantes'); listaArea.innerHTML = ''; comprovantes.forEach((comprovante, index) => { const item = document.createElement('div'); item.className = 'arquivo-item'; const nomeArquivo = document.createElement('span'); nomeArquivo.textContent = comprovante.filename; const removeBtn = document.createElement('span'); removeBtn.className = 'remove-arquivo'; removeBtn.innerHTML = '&times;'; removeBtn.onclick = function() { removerComprovante(index); }; item.appendChild(nomeArquivo); item.appendChild(removeBtn); listaArea.appendChild(item); }); }
Â  Â  function removerComprovante(index) { comprovantes.splice(index, 1); renderizarComprovantes(); }
Â  Â  function limparFormulario() { if (confirm("Tem certeza de que deseja limpar todos os campos do formulÃ¡rio?")) { document.getElementById('nomeSolicitante').value = ''; document.getElementById('supervisorNome').value = ''; document.querySelector('#tabelaDespesas tbody').innerHTML = ''; adicionarLinha(); comprovantes = []; renderizarComprovantes(); document.getElementById('tipoPix').value = 'cpf_cnpj'; configurarInputPix(); limparAssinatura(); window.scrollTo({ top: 0, behavior: 'smooth' }); } }
Â  Â  function adicionarLinha() { const tabelaBody = document.getElementById("tabelaDespesas").getElementsByTagName("tbody")[0]; const novaLinha = document.createElement("tr"); novaLinha.innerHTML = `<td><input type="date" max="${dataMaxima}" /></td><td><input type="text" class="descricao-despesa" placeholder="Descreva a despesa" /></td><td><input type="number" class="valor" step="0.01" min="0" placeholder="0.00" /></td><td><span class="remove-row" title="Remover linha">âœ–</span></td>`; tabelaBody.appendChild(novaLinha); atualizarEventos(); }
Â  Â  function atualizarEventos() { document.querySelectorAll(".valor").forEach(input => { input.oninput = calcularTotal; input.onblur = function() { const valor = parseFloat(this.value); if (!isNaN(valor)) { this.value = valor.toFixed(2); } }; }); document.querySelectorAll(".remove-row").forEach(btn => { btn.onclick = function() { this.closest("tr").remove(); calcularTotal(); }; };); document.querySelectorAll(".descricao-despesa").forEach(input => { input.oninput = function() { this.value = this.value.split(' ').map(word => { return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase(); }).join(' '); }; }); calcularTotal(); }
Â  Â Â 
Â  Â  function configurarInputPix() {
Â  Â  Â  Â  const tipo = document.getElementById("tipoPix").value;
Â  Â  Â  Â  const input = document.getElementById("chavePixInput");
Â  Â  Â  Â  input.oninput = null; input.value = "";
Â  Â  Â  Â  input.setAttribute("type", "text");
Â  Â  Â  Â  input.removeAttribute("maxlength");
Â  Â  Â  Â  input.removeAttribute("inputmode");
Â  Â  Â  Â  switch (tipo) {
Â  Â  Â  Â  Â  Â  case 'cpf_cnpj':
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("placeholder", "Digite o CPF ou CNPJ");
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("inputmode", "numeric");
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("maxlength", "18");
Â  Â  Â  Â  Â  Â  Â  Â  input.oninput = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let value = this.value.replace(/\D/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value.length > 14) value = value.substring(0, 14);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value.length <= 11) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value = value.replace(/(\d{3})(\d)/, '$1.$2'); value = value.replace(/(\d{3})(\d)/, '$1.$2'); value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value = value.replace(/^(\d{2})(\d)/, '$1.$2'); value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3'); value = value.replace(/\.(\d{3})(\d)/, '.$1/$2'); value = value.replace(/(\d{4})(\d)/, '$1-$2');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.value = value;
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case 'celular':
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("placeholder", "Ex: (99) 98765-4321");
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("type", "tel");
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case 'email':
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("placeholder", "Ex: seu.email@dominio.com");
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("type", "email");
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case 'aleatoria':
Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute("placeholder", "Digite a chave");
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function calcularTotal() { let total = 0; document.querySelectorAll(".valor").forEach(input => { const val = parseFloat(input.value); if (!isNaN(val)) total += val; }); document.getElementById("total").textContent = total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
Â  Â  function setupSignature() { signatureCanvas = document.getElementById("signature-pad"); if (!signatureCanvas) return; signatureCtx = signatureCanvas.getContext("2d"); signatureDrawing = false; signatureCanvas.addEventListener("mousedown", e => { signatureDrawing = true; signatureCtx.beginPath(); signatureCtx.moveTo(e.offsetX, e.offsetY); }); signatureCanvas.addEventListener("mousemove", e => { if (signatureDrawing) { signatureCtx.lineTo(e.offsetX, e.offsetY); signatureCtx.stroke(); } }); signatureCanvas.addEventListener("mouseup", () => signatureDrawing = false); signatureCanvas.addEventListener("mouseleave", () => signatureDrawing = false); signatureCanvas.addEventListener("touchstart", e => { e.preventDefault(); const touch = e.touches[0]; signatureDrawing = true; signatureCtx.beginPath(); signatureCtx.moveTo(touch.clientX - signatureCanvas.getBoundingClientRect().left, touch.clientY - signatureCanvas.getBoundingClientRect().top); }); signatureCanvas.addEventListener("touchmove", e => { e.preventDefault(); if (signatureDrawing) { const touch = e.touches[0]; signatureCtx.lineTo(touch.clientX - signatureCanvas.getBoundingClientRect().left, touch.clientY - signatureCanvas.getBoundingClientRect().top); signatureCtx.stroke(); } }); signatureCanvas.addEventListener("touchend", () => signatureDrawing = false); }
Â  Â  function limparAssinatura() { if (signatureCtx && signatureCanvas) { signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height); } }
Â  Â  window.onafterprint = function() { document.querySelectorAll('.print-value').forEach(span => span.remove()); document.getElementById('print-only-content').innerHTML = ''; }
Â  Â Â 
Â  Â  document.addEventListener("DOMContentLoaded", () => {
Â  Â  Â  adicionarLinha();
Â  Â  Â  setupSignature();
Â  Â  Â  configurarInputPix();
Â  Â  Â  const nomeSolicitanteInput = document.getElementById('nomeSolicitante');
Â  Â  Â  const supervisorNomeInput = document.getElementById('supervisorNome');
Â  Â  Â  nomeSolicitanteInput.addEventListener('input', function() { this.value = capitalizarNomeProprio(this.value); });
Â  Â  Â  supervisorNomeInput.addEventListener('input', function() { this.value = capitalizarNomeProprio(this.value); });
Â  Â  Â  if ('serviceWorker' in navigator) {
Â  Â  Â  Â  window.addEventListener('load', () => {
Â  Â  Â  Â  Â  navigator.serviceWorker.register('./sw.js')
Â  Â  Â  Â  Â  Â  .then(registration => {
Â  Â  Â  Â  Â  Â  Â  console.log('ServiceWorker registrado com sucesso:', registration.scope);
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  console.log('Falha no registro do ServiceWorker:', error);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>

</html>
